# GTA GXT 文本编辑器 v2.3 说明文档

这是一款专为《侠盗猎车手》(Grand Theft Auto) 系列游戏设计的强大文本文件编辑器，由“倾城剑舞”开发，支持 `.gxt`、`.gxt2` 和 `whm_table.dat` 文件格式。它为游戏汉化人员、Mod 开发者以及爱好者提供了一个高效、直观的工具，用于编辑和管理游戏中的文本内容，适用于从经典的 GTA III 到最新的 GTA V。

## 运行程序

该程序基于 **Python** 和 **PySide6** 开发，采用现代化深色主题界面，支持跨平台运行（主要针对 Windows 系统优化）。您可以从源代码运行程序。

### 环境要求
- **Python**: 3.6 或更高版本
- **PySide6**: 用于图形界面的 Qt 框架绑定
- 推荐安装其他依赖库（如 `pathlib`、`collections` 等，通常随 Python 标准库提供）

### 安装步骤
1. 安装 Python 3.x（确保已添加至系统 PATH）。
2. 安装 PySide6 库：
    ```bash
    pip install PySide6
    ```
3. 将以下文件放置在同一目录下：
   - `main.py`（主程序）
   - `gxt_parser.py`（GXT 文件解析核心）
   - `IVGXT.py`（GTA IV GXT 处理）
   - `VCGXT.py`（GTA Vice City GXT 处理）
   - `SAGXT.py`（GTA San Andreas GXT 处理）
   - `LCGXT.py`（GTA III GXT 处理）
   - `GTA4_WHM_Text_Extractor.py`（GTA4 WHM  文件处理）
   - `gta5_gxt2.py`（GTA V GXT2 文件处理）
4. 运行主程序：
    ```bash
    python main.py
    ```
## 主要功能

### 1. 全面的版本支持
- 支持 **GTA III, Vice City, San Andreas, GTA IV, GTA V** 的 `.gxt` 和 `.gxt2` 文件格式。
- 支持 GTA4网页的whm文本提取和生成数据库（使用插件映射数据库文本）。
- 自动识别文件版本，或允许用户手动指定版本以处理非标准文件。

### 2. 强大的编辑功能
- **文本条目管理**：
  - 添加、删除、修改文本条目（键值对）和数据表。
  - 支持 **GTA IV 和 GTA V** 的键名格式（明文或 0x 开头的 8 位十六进制哈希）。
  - 提供键名和值的快速**搜索/筛选**功能，方便定位特定内容。
- **批量操作**：
  - 批量添加新键值对。
  - 批量编辑多个条目的文本值。
  - 支持多选复制键值对到剪贴板，格式为 `Key=Value`。
- **数据验证**：
  - 自动验证键名格式，确保符合对应游戏版本的要求（例如，GTA VC 要求 1-7 位字母/数字/下划线，GTA SA 要求 1-8 位十六进制数）。
  - 对无效键名提供详细错误提示。

### 3. 灵活的导入与导出
- **导出**：
  - 导出整个 GXT/GXT2 文件为单个 `.txt` 文件，包含所有数据表。
  - 导出为多个 `.txt` 文件，每个数据表保存为单独文件（GTA III、GTA V 以及 whm_table.dat 除外）。
  - 导出的 TXT 文件格式清晰，易于外部编辑。
- **导入**：
  - 支持从单个或多个 `.txt` 文件导入数据，自动解析并合并到当前文件。
  - 支持创建新 GXT/GXT2 文件或合并到现有文件中，冲突键值对可选择覆盖或保留。
  - 提供详细的导入错误报告（如无效键名）。

### 4. 特色工具与易用性
- **GTA 字体贴图生成器**：
  - 生成游戏所需的透明 PNG 字体贴图，支持 GTA III, Vice City, San Andreas, GTA IV。
  - 支持从 GXT 文件、外部 TXT 文件或手动输入提取字符。
  - 生成 `font.png` 和 `font_preview.html` 文件，方便预览和调试。
- **文件关联**：
  - 支持 Windows 系统下 `.gxt` 和 `.gxt2` 文件关联，双击即可打开。
- **文件拖拽**：
  - 支持拖拽：单个`.gxt`, `.gxt2`, `whm_table.dat` 或多个 `.txt` 文件到窗口快速打开。
- **码表转换工具**：
  - 针对加密或乱码文本，提供基于自定义码表的批量字符替换/还原功能。
- **现代化界面**：
  - 深色主题，减少视觉疲劳。
  - 支持多语言（默认中文，加载 `zh_CN.qm` 翻译文件）。
  - 提供状态栏提示，实时反馈操作状态和文件信息。

## 软件界面

程序主界面设计直观，分为以下核心区域：
![GXT 编辑器主界面][1]
1. **菜单栏**：
   - **文件**：新建、打开、保存、另存为、导入、导出。
   - **编辑**：添加/删除表、键值对，批量编辑，复制等。
   - **工具**：字体贴图生成器、码表转换工具、设置文件关联。
   - **帮助**：查看使用说明、关于信息。
2. **表列表 (左侧)**：
   - 显示 GXT/GXT2 文件中的所有数据表（如 MAIN, AMERICAN 等）。
   - 支持搜索、添加、删除和重命名表（GTA V 和 whm_table.dat 不支持表操作）。
3. **键值对视图 (中央)**：
   - 显示当前选中表的所有键值对，包含序号、键名 (Key) 和文本值 (Value)。
   - 支持双击编辑、右键菜单操作（编辑、删除、复制）。
   - 提供搜索框，快速筛选键名或值。
4. **状态栏 (底部)**：
   - 显示当前文件路径、版本、修改状态和操作提示。
   - 实时更新，例如保存成功或字体生成进度。

## 使用说明

### 1. 打开与新建文件
- **打开文件**：
  - 菜单栏：`文件 -> 打开 GTA 文本文件`。
  - 拖拽：将 `.gxt`, `.gxt2`, `whm_table.dat` 或多个 `.txt` 文件拖入窗口。
  - 文件关联：设置后可双击 `.gxt` 或 `.gxt2` 文件直接打开。
  - 支持自动检测文件版本，提示用户手动选择版本以处理异常文件。
- **新建文件**：
  - 菜单栏：`文件 -> 新建 GXT 文件` 或 `新建 whm_table 文件`。
  - 选择游戏版本（GTA III, VC, SA, IV, V）或文件类型（whm_table.dat）。
  - 新建文件后可立即添加数据表和键值对。

### 2. 编辑数据
- **单个编辑**：
  - 双击键值对列表中的条目，或右键选择“编辑”。
  - 在弹出的对话框中修改键名和值，程序会验证键名格式。
- **批量编辑**：
  - 按 `Ctrl` 或 `Shift` 选择多个条目，右键选择“批量编辑”。
  - 可统一修改选中条目的值，键名保持不变。
- **复制**：
  - 选择一个或多个条目，右键选择“复制”，将键值对复制到剪贴板，格式为 `Key=Value`。

### 3. 添加与删除
- **表操作**：
  - 在左侧表列表下方点击 `➕` 添加新表，`🗑️` 删除当前表（GTA V 和 whm_table.dat 不支持）。
  - 右键表名可重命名（需符合版本规则）。
- **键值对操作**：
  - 点击中央区域下方 `➕ 添加键` 按钮，添加单个或批量键值对。
  - 选中条目后右键选择“删除”移除，或使用快捷键 `Delete`。

### 4. 保存与导出
- **保存**：
  - 快捷键：`Ctrl+S` 或菜单栏 `文件 -> 保存`。
  - 首次保存或使用“另存为”时，选择保存路径和文件名。
  - 保存 `.gxt` 文件时（GTA V 除外），可选择生成字符映射辅助文件（如 `CHARACTERS.txt`），便于汉化字体制作。
  - 支持记住用户选择（生成/不生成辅助文件）。
- **导出**：
  - **单个 TXT**：将所有数据表合并为一个 `.txt` 文件，格式为 `[表名]\n键=值\n`。
  - **多个 TXT**：每个数据表导出为单独的 `.txt` 文件，保存到指定文件夹（GTA III、GTA V 和 whm_table.dat 不支持）。
  - 导出路径可自定义，重复文件夹名会提示覆盖。
- **导入**：
  - 支持从 `.txt` 文件导入，自动解析表和键值对。
  - 导入时可选择覆盖冲突键或保留原有数据。
  - 提供详细错误提示（如无效键名或格式错误）。

### 码表转换工具
该工具用于对 GXT 文件中的文本内容进行批量字符替换或还原，以解决加密文本或乱码问题。

![码表转换工具截图][3]
*从左侧列表选择一个码表文件，然后执行正向或逆向转换。*

- **打开方式**：菜单栏 `工具 -> 码表转换工具`。
- **界面说明**：
  - **GXT_Tables (Chinese / original)**：程序会自动加载 `GXT_Tables（Chinese）` 和 `GXT_Tables（original）` 文件夹（需与程序在同一目录）中的 `.txt` 码表文件。点击文件名即可加载。
  - **状态栏**：显示码表的加载状态和映射条目总数。
  - **▶️ 应用码表 (正向转换)**：使用码表的“反向”映射（例如：`新字符 -> '一'`），将 GXT 文本**还原**为码表中的原始字符。
  - **◀️ 还原码表 (逆向转换)**：使用码表的“正向”映射（例如：`'一' -> 新字符`），将 GXT 文本**转换**为码表中的新字符。
- **使用步骤**：
  1. 打开码表转换工具。
  2. 从左侧或右侧列表中选择一个码表文件。
  3. 观察状态栏，确保码表加载成功。
  4. 根据需求，点击“应用码表”（通常用于还原加密文本）或“还原码表”（用于加密文本）。
  5. 操作将直接修改内存中的 GXT 数据，转换完成后关闭此窗口，并在主界面保存 GXT 文件。

### WHM 文本提取工具
此工具专用于处理 GTA IV 的网页（`.whm`）文件，支持批量导出文本为 `.txt`，或从 `.txt` 文件反向生成 `whm_table.dat` 数据库。

![WHM 文本提取工具截图][4]
*工具分为文件浏览器和批量处理两个标签页。*

- **打开方式**：菜单栏 `工具 -> WHM 文本提取工具`。
- **功能说明**：
  - **标签页 1: WHM 文件浏览器**
    - **打开文件夹**：点击 “📂 打开 pc/html 文件夹...”，选择 GTA IV 的 `pc/html` 目录。
    - **文件树**：左侧显示所有子网站文件夹及包含的 `.whm` 文件。支持搜索框筛选。
    - **内容预览**：点击 `.whm` 文件，右侧表格将显示提取出的所有文本（哈希键和预览值）。
    - **文本查看**：点击表格中的条目，下方文本框会显示完整的文本内容。
    - **单独导出**：在左侧文件树中右键点击一个或多个 `.whm` 文件，可将其导出为 `.txt`。
  - **标签页 2: 批量处理**
    - **从 WHM 批量导出 TXT**：
      1.  **WHM 根文件夹**：选择包含 `.whm` 文件的根文件夹（例如 `pc/html`）。
      2.  点击 “🚀 开始导出”。
      3.  程序将递归扫描所有 `.whm` 文件，并在*每个 .whm 文件所在的目录*下生成一个同名的 `.txt` 文件。
    - **从 TXT 批量生成数据库**：
      1.  **TXT 根文件夹**：选择包含上述步骤导出的 `.txt` 文件的根文件夹。
      2.  **输出数据库**：选择 `whm_table.dat` 文件的保存路径和文件名。
      3.  点击 “🛠️ 开始生成”。
      4.  程序将扫描所有 `.txt` 文件，合并内容并生成一个 `whm_table.dat` 文件。
    - **处理日志**：批量处理的进度和结果会实时显示在下方的日志窗口中。

### GTA 字体贴图生成器（GTA V不支持，会自动禁用！）
![字体贴图生成器][2]
一个强大的辅助工具，用于生成游戏所需的透明 PNG 字体贴图，支持汉化字体制作。

#### 使用步骤
1. **获取字符**：
   - **从 GXT 加载**：自动提取当前 GXT/GXT2 文件中的所有特殊字符（例如，非 ASCII 字符，Unicode 码点 > 255 或 > 0x7F，视版本而定）。
   - **导入文件**：从 `.txt`、 `wm_vcchs.dat` 或 `char_table.dat` 文件加载字符。
   - **输入字符**：在对话框中手动输入或粘贴字符，支持固定 64 字符宽度的换行显示。
2. **配置字体与参数**：
   - **游戏版本**：选择 GTA III, Vice City, San Andreas 或 GTA IV。
   - **贴图分辨率**：支持 2048x2048 或 4096x4096。
   - **字体选择**：
     - **系统字体**：从系统字体库中选择（如 Microsoft YaHei）。
     - **外部字体**：加载 `.ttf` 或 `.otf` 文件。
     - 支持调整字体大小、粗体、斜体等样式。
3. **预览**：
   - 点击“刷新预览”生成缩略图，显示在预览区。
   - 点击预览图可打开放大视图，支持滚轮缩放和鼠标拖动平移。
4. **生成文件**：
   - 点击“生成文件”，选择输出目录。
   - 生成以下文件：
     - `font.png`：透明背景的字体贴图，适用于游戏内使用。
     - `font_preview.html`：HTML 预览文件，显示字符与贴图的对应关系，包括字符编码、网格布局和贴图信息。
   - 生成过程会显示进度提示，完成后提供成功或错误信息。

#### 注意事项
- 不同游戏版本的字符网格大小不同（例如，GTA IV 为 66x66，Vice City 为 64x64）。
- 字符按 Unicode 码点排序，确保与游戏内渲染一致。
- 若字符过多，超出贴图尺寸的部分会被截断并显示警告。

## 作者
- **倾城剑舞**

## ❓ 常见问题

1. **Q：打开文件提示“无法识别版本”？**
   A：文件可能损坏或非标准 GXT/GXT2 格式。尝试通过菜单手动指定游戏版本，或检查文件完整性。

2. **Q：打开文件后文本显示乱码？**
   A：可能是文本被加密或使用了特殊编码。使用“码表转换工具”加载对应的码表文件进行还原。

3. **Q：生成的字体贴图在游戏中显示不正常？**
   A：可能原因：
   - 字体大小或样式不适合游戏版本，尝试调整字体大小或更换字体。（字符网格不超过显示区域，如果字体过大请调整字体大小后刷新浏览查看！）
   - 分辨率选择错误，确认是否与游戏要求匹配（2048x2048 或 4096x4096）。
   - 字符集不完整，检查是否遗漏特殊字符。
   - 确保导出的 `font.png` 文件正确放置在游戏的字体目录中。

4. **Q：GTA V 文件编辑后保存失败？**
    A：检查以下内容：
   - 键名格式是否正确（明文或 0x 开头的 8 位十六进制数）。
   - 保存路径是否有效，文件名是否以 `.gxt2` 结尾。
   - 确保程序有写入权限。

5. **Q：导入 TXT 文件时提示键名无效？**
    A：检查 TXT 文件中的键名是否符合对应游戏版本的格式要求：
   - GTA III：1-7 位字母/数字/下划线。
   - Vice City：1-7 位大写字母/数字/下划线。
   - San Andreas：1-8 位十六进制数。
   - GTA IV/V：明文或 0x 开头的 8 位十六进制数。
   - whm_table.dat：0x 开头的 8 位十六进制数。

6. **Q：文件关联设置后无法生效？**
    A：可能需要重启 Windows 资源管理器或计算机以应用更改。确保程序以管理员权限运行。

## 技术说明
- **文件格式支持**：
  - `.gxt`：GTA III, Vice City, San Andreas 使用。
  - `.gxt2`：GTA V 专用格式。
  - `whm_table.dat`：GTA IV 民间汉化补丁的自定义格式。
- **字符编码**：
  - GTA III/VC：支持 UTF-16 编码的非 ASCII 字符。
  - GTA SA/IV/V：支持 UTF-8 编码，特殊字符需通过字体贴图支持。
- **依赖文件**：
  - 核心逻辑文件（如 `gxt_parser.py`、`gta5_gxt2.py` 等）需与 `main.py` 位于同一目录。
  - 翻译文件（`zh_CN.qm`）用于界面本地化，优先加载自定义翻译，其次加载 Qt 自带翻译。
- **性能优化**：
  - 使用内存映射文件（`MemoryMappedFile`）加速大文件处理。
  - 优化批量导入和键名验证逻辑，减少处理时间。
  - 字体贴图生成支持高分辨率（4096x4096），确保高质量输出。

## 致谢
感谢所有为 GTA 系列游戏汉化和 Mod 开发做出贡献的社区成员。本工具旨在为汉化工作提供便捷支持，欢迎反馈和建议！

[1]: https://img.acgs.one/2025-09-21/gE9xlm2F0m.webp
[2]: https://img.acgs.one/2025-09-21/4maSqI6X5W.webp
[3]: https://img.acgs.one/2025-10-24/Do289XEZg6.webp
[4]: https://img.acgs.one/2025-10-24/plaOitmJsh.webp